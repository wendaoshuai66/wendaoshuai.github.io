(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{350:function(s,n,a){"use strict";a.r(n);var r=a(10),e=Object(r.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"前端中经常出现的错误及捕获"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端中经常出现的错误及捕获"}},[s._v("#")]),s._v(" 前端中经常出现的错误及捕获")]),s._v(" "),n("h2",{attrs:{id:"_1-例子-1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-例子-1"}},[s._v("#")]),s._v(" 1.例子 1")]),s._v(" "),n("p",[s._v("html 中第一个 script 标签对 报错 第二个 script 标签对能够输出")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v("<script>\n    error\n    console.log(1)\n<\/script>\n<script>\n    //能输出，独立的script是一个独立的代码段，不影响\n    console.log(2)\n<\/script>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"_2-例子-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-例子-2"}},[s._v("#")]),s._v(" 2.例子 2")]),s._v(" "),n("p",[s._v("try catch 可以捕获到错误")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v('try {\n        err\n        var er = "error"\n            // 遇到语法错误影响会退出， 不会执行\n    } catch (error) {\n        console.log(error)\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v('但是看下面例子 var er = "error 语法错误呢')]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v('try {\n        var er = "error\n            // 遇到语法错误影响会退出， 不会执行\n    } catch (error) {\n        console.log(error)\n    }\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("输出会直接报错，为什么呢，语法错误了，引擎退出，js 不执行了，所以捕获不到")]),s._v(" "),n("p",[s._v("再看看下面的例子，try 捕获异步的错误")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v("<script>\n     \n    try {\n        setTimeout(() => {\n            err\n        }, 1000)\n    } catch (error) {\n        console.log(error)\n    }\n    <\/script>\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("但是很遗憾捕获不到，所以总结 try catch 处理异常的能力有限，只能捕捉到同步的错误,但是语法错误，异步捕获不到。")]),s._v(" "),n("p",[s._v("##3.例子 3")]),s._v(" "),n("p",[s._v("根据上面异步错误捕获不到，那谁能够捕获到异步的错误呢，接下来看下面的代码")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v(" window.onerror = function(msg, url, row, col, err) {\n    console.log('我已经捕获到错误')\n    console.log(msg, url, row, col, err)\n    return true\n}\n\ntry {\n    setTimeout(() => {\n        err\n    }, 1000)\n} catch (error) {\n    console.log(error)\n}\n\nerr\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("根据 window.onerror 可以具体捕获到同步与异步的错误信息。")]),s._v(" "),n("p",[s._v("那么我们在看一段代码")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v(' <img src="xxx.png" alt="">\n  window.onerror = function(msg, url, row, col, err) {\n            console.log(\'我已经捕获到错误\')\n            console.log(msg, url, row, col, err)\n            return true\n        }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("资源加载报错，捕获不到")]),s._v(" "),n("p",[s._v("总结  1.try catch 可以捕获到意料之内的错误，")]),s._v(" "),n("p",[s._v("2.window.onerror 可以捕获到意料之外的错误")]),s._v(" "),n("p",[s._v("3.window.onerror 必须返回 true ，异常会向上抛出")]),s._v(" "),n("p",[s._v("4.当遇到 资源加载时报错，也捕获不到")]),s._v(" "),n("h2",{attrs:{id:"_4-例子-4"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-例子-4"}},[s._v("#")]),s._v(" 4.例子 4")]),s._v(" "),n("p",[s._v("根据上述例子捕获不到资源加载时错误，可以使用下面的例子")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v('  <img src="xx.png" alt="">\n    <script>\n        window.addEventListener(\'error\', (msg, url, row, col, err) => {\n                console.log(msg, url, row, col, err)\n                return false\n            }, true)\n            //事件捕获\n    <\/script>\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h2",{attrs:{id:"_5-例子-5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-例子-5"}},[s._v("#")]),s._v(" 5.例子 5")]),s._v(" "),n("p",[s._v("那么遇到 throw 和 reject 呢")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v("window.addEventListener('unhandledrejection', (e) => {\n        e.preventDefault()\n        console.log(e.reason)\n    })\n    Promise.reject('xxx')\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h2",{attrs:{id:"_6-例子-6"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-例子-6"}},[s._v("#")]),s._v(" 6.例子 6")]),s._v(" "),n("p",[s._v("NodeJS 里程确实有“脆弱”的一面，单线程的某处产生了“未处理的”异常确实会导致整个 Node.JS 的崩溃退出，来看个例子, 这里有一个 node-error.js 的文件：")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v("var http = require(＇http＇);\n\nvar server = http.createServer(function (req, res) {\n\n  //这里有个错误，params 是 undefined\n  var ok = req.params.ok;\n\n  res.writeHead(200, {＇Content-Type＇: ＇text/plain＇});\n  res.end(＇Hello World\n＇);\n});\n\nserver.listen(8080, ＇127.0.0.1＇);\n\nconsole.log(＇Server running at http://127.0.0.1:8080/＇\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("启动服务，并在地址栏测试一下发现 http://127.0.0.1:8080/  不出所料，node 崩溃了")]),s._v(" "),n("p",[s._v("使用 uncaughtException")]),s._v(" "),n("div",{staticClass:"language-plain line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-plain"}},[n("code",[s._v("process.on(＇uncaughtException＇, function (err) {\n  //打印出错误\n  console.log(err);\n  //打印出错误的调用栈方便调试\n  console.log(err.stack)；\n});\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports}}]);